name: Python package

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
    - name: Set up Python 3.7
      uses: actions/setup-python@v1
      with:
        python-version: 3.7
    - name: Install dependencies
      run: |
        apt-get install -y gettext
        python -m pip install --upgrade pip
        pip install pipenv
        pipenv sync --dev
    - name: Build
      run: |
        pipenv run build -W
        pipenv run build_ja -W
    - name: Test
      run: |
        msgfmt -o /dev/null source/locales/ja/LC_MESSAGES/*.po -v --statistics | tee msgfmt-error.log
        # Fail if statistics of translation file include messages after 'translated messages'.
        #   invalid ex. source/locales/ja/LC_MESSAGES/index.po: 4 translated messages, 1 fuzzy translation, 1 untranslated message.
        grep -v -q ' translated messages, *' msgfmt-error.log
